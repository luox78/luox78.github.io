<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  
  <title>ASP.NET MVC 控制器 | luox78</title>
  <meta name="description" content="Blog for luox78" />
  <meta name="keywords" content="" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="theme-color" content=" rgb(59,95,208)">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
    <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
  <link rel="shortcut icon" href="/images/dev.ico">
  <link rel="alternate" href="/atom.xml" title="luox78">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="人么总说事件会改变一切，当实际上你必须自己动手去改变一切——Andy Warhol 对输入请求进行路由在软件中，URI（统一资源标识符）是指通过一个位置或者名称来引用资源。 当URI通过位置来识别资源是，就叫做URL（统一定位符） 当URI通过名称标志资源时，就叫做URN（统一资源名称） ASP.NET MVC 旨在处理更通用的URI，ASP.NET Web Forms只要处理位置感知的物理资源">
<meta name="keywords" content="ASP.NET MVC5 编程实战">
<meta property="og:type" content="article">
<meta property="og:title" content="ASP.NET MVC 控制器">
<meta property="og:url" content="https://luox78.github.io/2018/02/07/ASP.NET MVC 控制器/index.html">
<meta property="og:site_name" content="luox78">
<meta property="og:description" content="人么总说事件会改变一切，当实际上你必须自己动手去改变一切——Andy Warhol 对输入请求进行路由在软件中，URI（统一资源标识符）是指通过一个位置或者名称来引用资源。 当URI通过位置来识别资源是，就叫做URL（统一定位符） 当URI通过名称标志资源时，就叫做URN（统一资源名称） ASP.NET MVC 旨在处理更通用的URI，ASP.NET Web Forms只要处理位置感知的物理资源">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-02-09T13:42:53.603Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ASP.NET MVC 控制器">
<meta name="twitter:description" content="人么总说事件会改变一切，当实际上你必须自己动手去改变一切——Andy Warhol 对输入请求进行路由在软件中，URI（统一资源标识符）是指通过一个位置或者名称来引用资源。 当URI通过位置来识别资源是，就叫做URL（统一定位符） 当URI通过名称标志资源时，就叫做URN（统一资源名称） ASP.NET MVC 旨在处理更通用的URI，ASP.NET Web Forms只要处理位置感知的物理资源">
    
  <link href="https://fonts.googleapis.com/css?family=Inconsolata|Titillium+Web" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet">
  <link href='//cdn.bootcss.com/node-waves/0.7.5/waves.min.css' rel='stylesheet'>
  <link rel="stylesheet" href="/style.css">
  <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
  </script>
</head>

<body>
  <div id="loading">
    <div id="loading-center">
    <div id="loading-center-absolute">
    <div class="object" id="object_one"></div>
    <div class="object" id="object_two"></div>
    <div class="object" id="object_three"></div>
    <div class="object" id="object_four"></div>
    <div class="object" id="object_five"></div>
    <div class="object" id="object_six"></div>
    <div class="object" id="object_seven"></div>
    <div class="object" id="object_eight"></div>
    <div class="object" id="object_big"></div>
    </div>
    </div>
     
    </div>
  <header class="l_header">
	<div class='wrapper'>
		<div class="nav-main container container--flex">
			<a class="logo flat-box" href='/' >
				luox78
			</a>
			<div class='menu'>
				<ul class='h-list'>
					
						<li>
							<a class='flat-box nav-home' href='/'>
								Home
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-archives' href='/archives'>
								Archives
							</a>
						</li>
					
						<li>
							<a class='flat-box nav-about' href='/about.html'>
								About
							</a>
						</li>
					
				</ul>
				<div class='underline'></div>
			</div>
			
				<div class="m_search">
					<form name="searchform" class="form u-search-form">
						<input type="text" class="input u-search-input" placeholder="Search" />
						<span class="icon icon-search"></span>
					</form>
				</div>
			
			<ul class='switcher h-list'>
				
					<li class='s-search'><a href='javascript:void(0)'><span class="icon icon-search flat-box"></span></a></li>
				
				<li class='s-menu'><a href='javascript:void(0)'><span class="icon icon-menu flat-box"></span></a></li>
			</ul>
		</div>
		
		<div class='nav-sub container container--flex'>
			<a class="logo" class="flat-box" href='javascript:void(0)'>
				Word of Forks
			</a>

			<ul class='switcher h-list'>
				<li class='s-comment'><a href='javascript:void(0)'><span class="icon icon-chat_bubble_outline flat-box"></span></a></li>
				<li class='s-top'><a href='javascript:void(0)'><span class="icon icon-arrow_upward flat-box"></span></a></li>
				<li class='s-toc'><a href='javascript:void(0)'><span class="icon icon-format_list_numbered flat-box"></span></a></li>
			</ul>
		</div>
	</div>
</header>
<aside class="menu-phone">
	<nav>
		
			<a href="/" class="nav-home nav">
				Home
			</a>
		
			<a href="/archives" class="nav-archives nav">
				Archives
			</a>
		
			<a href="/about.html" class="nav-about nav">
				About
			</a>
		
	</nav>
</aside>

  <div id="loading-bar-wrapper">
  <div id="loading-bar"></div>
</div>


  <!-- <script>
      var count=0;
      function setLoadingBarProgress() {
          if(count==100){
              count=0;
          }
          document.getElementById('loading-bar').style.width = count + "%";
      }
  </script> -->
  <div class="l_body">
    <div class='container clearfix'>
      <div class='l_main'>
        <article id="post-ASP.NET MVC 控制器"
	class="post white-box article-type-post"
	itemscope itemprop="blogPost">
<section class='meta'>
 <h2 class="title">
		 <a href="/2018/02/07/ASP.NET MVC 控制器/">
				 ASP.NET MVC 控制器
		 </a>
 </h2>
 <time>
		 Feb 7, 2018
 </time>
 
    
    <div class='cats'>
        <a href="/categories/ASP-NET-MVC/">ASP.NET MVC</a>
    </div>

 <span id="busuanzi_container_page_pv">
		 
		<a href="javascript:void(0)" class="read_cats">本文总阅读量:<span id="busuanzi_value_page_pv"></span>
		</a>
 </span>
</section>

<section class="toc-wrapper"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#对输入请求进行路由"><span class="toc-number">1.</span> <span class="toc-text">对输入请求进行路由</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#模拟ASP-NET-MVC运行时"><span class="toc-number">1.1.</span> <span class="toc-text">模拟ASP.NET MVC运行时</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#应用程序路由"><span class="toc-number">1.2.</span> <span class="toc-text">应用程序路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#url模式与路由"><span class="toc-number">1.2.1.</span> <span class="toc-text">url模式与路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#定义应用程序路由"><span class="toc-number">1.2.2.</span> <span class="toc-text">定义应用程序路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#处理路由"><span class="toc-number">1.2.3.</span> <span class="toc-text">处理路由</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#路由处理程序"><span class="toc-number">1.2.4.</span> <span class="toc-text">路由处理程序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#处理物理文件的请求"><span class="toc-number">1.2.5.</span> <span class="toc-text">处理物理文件的请求</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#阻止已定义的路由"><span class="toc-number">1.2.6.</span> <span class="toc-text">阻止已定义的路由</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#控制器类"><span class="toc-number">2.</span> <span class="toc-text">控制器类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#编写控制器类"><span class="toc-number">2.1.</span> <span class="toc-text">编写控制器类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#操作和http动词"><span class="toc-number">2.2.</span> <span class="toc-text">操作和http动词</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#处理输入数据"><span class="toc-number">2.3.</span> <span class="toc-text">处理输入数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#获取request对象中的输入数据"><span class="toc-number">2.3.1.</span> <span class="toc-text">获取request对象中的输入数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#从路由中获取输入数据"><span class="toc-number">2.3.2.</span> <span class="toc-text">从路由中获取输入数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#利用valueprovider字典获取所有来源的值"><span class="toc-number">2.3.3.</span> <span class="toc-text">利用valueprovider字典获取所有来源的值</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#产生操作结果"><span class="toc-number">2.4.</span> <span class="toc-text">产生操作结果</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#actionresult构造"><span class="toc-number">2.4.1.</span> <span class="toc-text">actionresult构造</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#一些派生类"><span class="toc-number">2.4.2.</span> <span class="toc-text">一些派生类</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#深入执行操作结果的机制"><span class="toc-number">2.4.3.</span> <span class="toc-text">深入执行操作结果的机制</span></a></li></ol></li></ol></li></ol></section>

<section class="article typo">
 <div class="article-entry" itemprop="articleBody">
		 <p> 人么总说事件会改变一切，当实际上你必须自己动手去改变一切——<em>Andy Warhol</em></p>
<h2 id="对输入请求进行路由"><a href="#对输入请求进行路由" class="headerlink" title="对输入请求进行路由"></a>对输入请求进行路由</h2><p>在软件中，URI（统一资源标识符）是指通过一个位置或者名称来引用资源。</p>
<p>当URI通过位置来识别资源是，就叫做URL（统一定位符）</p>
<p>当URI通过名称标志资源时，就叫做URN（统一资源名称）</p>
<p>ASP.NET MVC 旨在处理更通用的URI，ASP.NET Web Forms只要处理位置感知的物理资源<a id="more"></a></p>
<h3 id="模拟ASP-NET-MVC运行时"><a href="#模拟ASP-NET-MVC运行时" class="headerlink" title="模拟ASP.NET MVC运行时"></a>模拟ASP.NET MVC运行时</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ProcessRequest</span>(<span class="params">HttpContext context</span>)</span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="comment">//map对应的参数</span></span><br><span class="line">            <span class="keyword">var</span> segments = context.Request.Url.Segments;</span><br><span class="line">            <span class="keyword">var</span> controller = segments[<span class="number">1</span>].TrimEnd(<span class="string">'/'</span>);</span><br><span class="line">            <span class="keyword">var</span> action = segments[<span class="number">2</span>].TrimEnd(<span class="string">'/'</span>);</span><br><span class="line">            <span class="keyword">var</span> param = segments[<span class="number">3</span>].TrimEnd(<span class="string">'/'</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//通过反射实例化对应的controller</span></span><br><span class="line">            <span class="keyword">var</span> fullname = <span class="string">$"<span class="subst">&#123;<span class="keyword">this</span>.GetType().Namespace&#125;</span>.<span class="subst">&#123;controller&#125;</span>"</span>;</span><br><span class="line">            <span class="keyword">var</span> controllerType = Type.GetType(fullname);</span><br><span class="line">            <span class="keyword">var</span> instance = Activator.CreateInstance(controllerType);</span><br><span class="line">            <span class="keyword">var</span> methodInfo =</span><br><span class="line">                controllerType.GetMethod(action, BindingFlags.IgnoreCase | BindingFlags.Public | BindingFlags.Instance);</span><br><span class="line">            <span class="keyword">var</span> res = methodInfo.Invoke(instance, <span class="literal">null</span>) <span class="keyword">as</span> <span class="keyword">string</span>;<span class="comment">//假设没参数</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//输出</span></span><br><span class="line">            context.Response.Write(res);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>controller类中</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> _0101</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HomeController</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="built_in">string</span> <span class="title">Test</span><span class="params">()</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"hello world"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这个简单的例子模拟了ASP.NET MVC使用的基本机制，处理请求的组件是控制器类，通过request的url映射到专门的控制器类进行处理</p>
<h3 id="应用程序路由"><a href="#应用程序路由" class="headerlink" title="应用程序路由"></a>应用程序路由</h3><h4 id="url模式与路由"><a href="#url模式与路由" class="headerlink" title="url模式与路由"></a>url模式与路由</h4><p>路由：代表URL绝对路径的模式匹配字符串，即没有协议，IP地址，端口号的url字符串</p>
<p>比如：<a href="http://localhost:3462/home/test" target="_blank" rel="noopener">http://localhost:3462/home/test</a>    ==&gt;    /home/test</p>
<p>路由可以是常量也可以是占位符，mvc系统默认的路由是{controller}/{action}/{id}，它可以匹配如Home/Index/1子类的路由</p>
<h4 id="定义应用程序路由"><a href="#定义应用程序路由" class="headerlink" title="定义应用程序路由"></a>定义应用程序路由</h4><p>mvc中路由是在<code>Global.asax</code>下被注册</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MvcApplication</span> :</span> System.Web.HttpApplication</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">Application_Start</span><span class="params">()</span></span></span><br><span class="line"><span class="function">       </span>&#123;</span><br><span class="line">           RouteConfig.RegisterRoutes(RouteTable.Routes);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>对应的类在<code>App_Start/RouteConfig.cs</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RouteConfig</span></span></span><br><span class="line"><span class="class">    &#123;</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RegisterRoutes</span><span class="params">(RouteCollection routes)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            routes.IgnoreRoute(<span class="string">"&#123;resource&#125;.axd/&#123;*pathInfo&#125;"</span>);</span><br><span class="line"></span><br><span class="line">            routes.MapRoute(</span><br><span class="line">                name: <span class="string">"Default"</span>,</span><br><span class="line">                url: <span class="string">"&#123;controller&#125;/&#123;action&#125;/&#123;id&#125;"</span>,</span><br><span class="line">                defaults: <span class="keyword">new</span> &#123; controller = <span class="string">"Home"</span>, action = <span class="string">"Index"</span>, id = UrlParameter.Optional &#125;</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>路由集合routes添加路由一般通过<code>MapRoute</code>进行配置，但如果你的路由有<code>MapRoute</code>不支持的参数可以使用</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">var<span class="built_in"> route </span>= newRoute(<span class="built_in">..</span>);</span><br><span class="line">RouteTable.Routes.<span class="builtin-name">Add</span>(<span class="string">"RouteName"</span>,route);</span><br></pre></td></tr></table></figure>
<p>进行添加，<code>maproute</code>里面的参数：</p>
<p>name：路由名</p>
<p>url：url匹配模式</p>
<p>defaults：该url默认值对象</p>
<p>如<a href="http://localhost:3462/并没有输入controller/action但处理程序会匹配到默认值，导航到http://localhost:3462/Home/Index下" target="_blank" rel="noopener">http://localhost:3462/并没有输入controller/action但处理程序会匹配到默认值，导航到http://localhost:3462/Home/Index下</a></p>
<h4 id="处理路由"><a href="#处理路由" class="headerlink" title="处理路由"></a>处理路由</h4><p>ASP.NET url路由模块总是根据注册的顺序进行匹配，所以前一项设置默认值会导致后一项永远得不到匹配</p>
<p>路由同时可以添加约束列表,MapRoute的一个重载</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public static<span class="built_in"> Route </span>MapRoute(this RouteCollection routes, string name, string url, object defaults, object constraints);</span><br></pre></td></tr></table></figure>
<p>可以利用正则表达式将不正确的url拒之门外</p>
<figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">routes.MapRoute(</span><br><span class="line"><span class="symbol">              name:</span> <span class="string">"Product"</span>,</span><br><span class="line"><span class="symbol">              url:</span> <span class="string">"&#123;controller&#125;/&#123;productid&#125;/&#123;locale&#125;"</span>,</span><br><span class="line"><span class="symbol">              defaults:</span> <span class="class">new </span>&#123; controller = <span class="string">"Home"</span>, action = <span class="string">"Index"</span>, locale = <span class="string">"cn-ch"</span> &#125;,</span><br><span class="line"><span class="symbol">              constraints:</span> <span class="class">new </span>&#123; productid = @<span class="string">"\d&#123;4&#125;"</span>, locale = <span class="string">"[a-zA-Z]&#123;2&#125;-[a-zA-Z]&#123;2&#125;"</span> &#125;</span><br><span class="line">          );</span><br></pre></td></tr></table></figure>
<h4 id="路由处理程序"><a href="#路由处理程序" class="headerlink" title="路由处理程序"></a>路由处理程序</h4><p>路由处理程序实现了<code>IRouteHandler</code>的接口</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public<span class="built_in"> interface </span>IRouteHandler</span><br><span class="line">    &#123;</span><br><span class="line">        IHttpHandler GetHttpHandler(RequestContext requestContext);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><code>RequestContext</code>中封装了路由的相关信息，MVC框架并没有提供很对内置的路由处理程序，因为自定义路由的需求并不普遍</p>
<h4 id="处理物理文件的请求"><a href="#处理物理文件的请求" class="headerlink" title="处理物理文件的请求"></a>处理物理文件的请求</h4><p>在<code>RouteConfig.cs</code>下添加<code>routes.RouteExistingFiles = true;</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">RegisterRoutes</span><span class="params">(RouteCollection routes)</span></span></span><br><span class="line"><span class="function">        </span>&#123;</span><br><span class="line">            routes.RouteExistingFiles = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h4 id="阻止已定义的路由"><a href="#阻止已定义的路由" class="headerlink" title="阻止已定义的路由"></a>阻止已定义的路由</h4><p>相同地方</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">routes.IgnoreRoute(<span class="string">"&#123;resource&#125;.axd/&#123;*pathInfo&#125;"</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h2 id="控制器类"><a href="#控制器类" class="headerlink" title="控制器类"></a>控制器类</h2><h3 id="编写控制器类"><a href="#编写控制器类" class="headerlink" title="编写控制器类"></a>编写控制器类</h3><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">HomeController</span> : <span class="title">Controller</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="function"><span class="keyword">public</span> ActionResult <span class="title">Index</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">       </span>&#123;</span><br><span class="line">           <span class="keyword">return</span> View();</span><br><span class="line">       &#125;</span><br><span class="line"> </span><br><span class="line"> 	   [<span class="meta">NonAction</span>]</span><br><span class="line">       <span class="function"><span class="keyword">public</span> ActionResult <span class="title">About</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">       </span>&#123;</span><br><span class="line">       。。。</span><br><span class="line">       &#125;</span><br><span class="line"> </span><br><span class="line">       [<span class="meta">ActionName(<span class="meta-string">"About"</span>)</span>]</span><br><span class="line">       <span class="function"><span class="keyword">public</span> ActionResult <span class="title">Qunimalegebi</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">       </span>&#123;</span><br><span class="line">       ....</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p> <code>[NonAction]</code>阻止action绑定到About方法上</p>
<p><code>[ActionName(&quot;About&quot;)]</code>指定Qunimalegebi方法的绑定action name</p>
<h3 id="操作和http动词"><a href="#操作和http动词" class="headerlink" title="操作和http动词"></a>操作和http动词</h3><figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[AcceptVerbs(HttpVerbs.Get|HttpVerbs.Post)]</span><br><span class="line">        <span class="keyword">public</span> ActionResult Contact()</span><br><span class="line">        &#123;</span><br><span class="line">            ViewBag.Message = <span class="string">"Your contact page."</span>;</span><br><span class="line"> </span><br><span class="line">            <span class="function"><span class="keyword">return</span> <span class="title">View</span><span class="params">()</span></span>;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>通过<code>AcceptVerbs</code>特性绑定http请求方式，<code>httpverbs</code>枚举类型值</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public <span class="class"><span class="keyword">enum</span> <span class="title">HttpVerbs</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        Get = <span class="number">1</span>,</span><br><span class="line">        Post = <span class="number">2</span>,</span><br><span class="line">        Put = <span class="number">4</span>,</span><br><span class="line">        Delete = <span class="number">8</span>,</span><br><span class="line">        Head = <span class="number">16</span>,</span><br><span class="line">        Patch = <span class="number">32</span>,</span><br><span class="line">        Options = <span class="number">64</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>利用“|”可以响应多个请求方式</p>
<h3 id="处理输入数据"><a href="#处理输入数据" class="headerlink" title="处理输入数据"></a>处理输入数据</h3><h4 id="获取request对象中的输入数据"><a href="#获取request对象中的输入数据" class="headerlink" title="获取request对象中的输入数据"></a>获取request对象中的输入数据</h4><p>request中包含<code>form，querystring，cookie，header</code>等数据</p>
<h4 id="从路由中获取输入数据"><a href="#从路由中获取输入数据" class="headerlink" title="从路由中获取输入数据"></a>从路由中获取输入数据</h4><p>路由和上面得一致，controller中</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">var str</span> = RouteData.Values[<span class="string">"locale"</span>];</span><br></pre></td></tr></table></figure>
<p>url：<a href="http://localhost:4426/home/1111/en-ed?data=11" target="_blank" rel="noopener">http://localhost:4426/home/1111/en-ed?data=11</a></p>
<p>str为en-ed，所以routedata捕获的是定义好的路由值，同时根据上述路由会匹配到第一个时直接结束，所以str2位null</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var str2 = RouteData.Values[<span class="string">"id"</span>]<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h4 id="利用valueprovider字典获取所有来源的值"><a href="#利用valueprovider字典获取所有来源的值" class="headerlink" title="利用valueprovider字典获取所有来源的值"></a>利用<code>valueprovider</code>字典获取所有来源的值</h4><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str6 = ValueProvider.GetValue(<span class="string">"locale"</span>).AttemptedValue;<span class="comment">//路由的值</span></span><br><span class="line"><span class="keyword">var</span> str7 = ValueProvider.GetValue(<span class="string">"data"</span>).AttemptedValue;<span class="comment">//get值</span></span><br></pre></td></tr></table></figure>
<p><code>ValueProvider.GetValue(&quot;data&quot;)</code>会有两个属性</p>
<p><code>RawValue</code> Object类型原始值</p>
<p><code>AttemptedValue</code> string 强转成string类型的值</p>
<h3 id="产生操作结果"><a href="#产生操作结果" class="headerlink" title="产生操作结果"></a>产生操作结果</h3><p>controller类中大部分方法返回的都是<code>ActionResult</code>类型，下面就看看<code>ActionResult</code>类是什么</p>
<h4 id="actionresult构造"><a href="#actionresult构造" class="headerlink" title="actionresult构造"></a>actionresult构造</h4><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title">ActionResult</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">protected</span> <span class="title">ActionResult</span>(<span class="params"></span>)</span>;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">ExecuteResult</span>(<span class="params">ControllerContext context</span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>actionresult</code>类是抽象类，定义了一个方法为ExecuteResult。该方法为具体派生类执行时触发的一系列动作</p>
<h4 id="一些派生类"><a href="#一些派生类" class="headerlink" title="一些派生类"></a>一些派生类</h4><ul>
<li><a href="https://msdn.microsoft.com/zh-cn/library/system.web.mvc.contentresult.aspx" target="_blank" rel="noopener">ContentResult</a></li>
<li><a href="https://msdn.microsoft.com/zh-cn/library/system.web.mvc.emptyresult.aspx" target="_blank" rel="noopener">EmptyResult</a></li>
<li><a href="https://msdn.microsoft.com/zh-cn/library/system.web.mvc.fileresult.aspx" target="_blank" rel="noopener">FileResult</a></li>
<li><a href="https://msdn.microsoft.com/zh-cn/library/system.web.mvc.httpunauthorizedresult.aspx" target="_blank" rel="noopener">HttpUnauthorizedResult</a></li>
<li><a href="https://msdn.microsoft.com/zh-cn/library/system.web.mvc.javascriptresult.aspx" target="_blank" rel="noopener">JavaScriptResult</a></li>
<li><a href="https://msdn.microsoft.com/zh-cn/library/system.web.mvc.jsonresult.aspx" target="_blank" rel="noopener">JsonResult</a></li>
<li><a href="https://msdn.microsoft.com/zh-cn/library/system.web.mvc.redirectresult.aspx" target="_blank" rel="noopener">RedirectResult</a></li>
<li><a href="https://msdn.microsoft.com/zh-cn/library/system.web.mvc.redirecttorouteresult.aspx" target="_blank" rel="noopener">RedirectToRouteResult</a></li>
<li><a href="https://msdn.microsoft.com/zh-cn/library/system.web.mvc.viewresultbase.aspx" target="_blank" rel="noopener">ViewResultBase</a></li>
</ul>
<p><code>FileResult</code>派生</p>
<ul>
<li><code>FilePathResult</code>: 直接将一个文件发送给客户端</li>
</ul>
<p>可以通过更改报文头实现直接下载，不用浏览器解析</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> ActionResult <span class="title">GetFile</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">       </span>&#123;</span><br><span class="line">           <span class="keyword">var</span> image = <span class="keyword">new</span> FilePathResult(<span class="string">"~/多云.jpg"</span>, <span class="string">"image/jpg"</span>);</span><br><span class="line">           Response.AddHeader(<span class="string">"Content-Disposition"</span>, <span class="string">$"attachment;filename=\"<span class="subst">&#123;HttpUtility.UrlDecode(<span class="string">"多云.jpg"</span>)&#125;</span>\""</span>);</span><br><span class="line"> </span><br><span class="line">           <span class="keyword">return</span> image;</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>FileContentResult</code>: 返回byte字节给客户端（比如图片）</li>
<li><code>FileStreamResult</code>: 返回流</li>
</ul>
<h4 id="深入执行操作结果的机制"><a href="#深入执行操作结果的机制" class="headerlink" title="深入执行操作结果的机制"></a>深入执行操作结果的机制</h4><p>控制器中我添加了以下方法</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public ActionResult GetScript()</span><br><span class="line">        &#123;</span><br><span class="line">            string<span class="built_in"> script </span>= <span class="string">"alert('hello')"</span>;</span><br><span class="line">            return JavaScript(script);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到返回的是JavaScript(script)；转到controller类定义可以看到</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">internal</span> <span class="keyword">virtual</span> JavaScriptResult <span class="title">JavaScript</span>(<span class="params"><span class="keyword">string</span> script</span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> JavaScriptResult()</span><br><span class="line">  &#123;</span><br><span class="line">  	Script=script  </span><br><span class="line">  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所以JavaScript(script)不过就是controller类的一个帮助方法而已，充当<code>JavaScriptResul</code>t的对象工厂的角色，类似的如View(),大家都知道View参数默认值是View文件夹下面控制器名文件夹下面的index，所以不传参数并不代表没有参数，<code>JavaScriptResult</code>实现</p>
<figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JavaScriptResult</span> : <span class="title">ActionResult</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">string</span> Script&#123;<span class="keyword">get</span>;<span class="keyword">set</span>;&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">ExecuteResult</span>(<span class="params">ControllerContext context</span>)</span></span><br><span class="line"><span class="function">  </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(context == <span class="literal">null</span>)</span><br><span class="line">    	<span class="keyword">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="keyword">nameof</span>(context));</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">var</span> response = context.HttpContext.Response;</span><br><span class="line">    response.ContentType = <span class="string">"application/x-javascript"</span>;</span><br><span class="line">    <span class="keyword">if</span>(Script != <span class="literal">null</span>)</span><br><span class="line">    	response.Write(Script);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到<code>JavaScriptResult</code>里面仍然是调用的<code>response.ContentType,response.write</code></p>
<p>注意：</p>
<ul>
<li>如果控制器没有返回<code>ActionResult</code>，不会抛出异常，mvc框架会将return中的任何值封装成<code>ContentResult</code>对象序列化返回，没有返回值会映射成<code>EmptyResult</code></li>
<li>mvc中只dotNet 4.5 之后可以使用<code>async/await</code>语法执行异步操作响应界面</li>
</ul>

 </div>
 
 <div class="article-tags tags">
		 
		 <a href="/tags/ASP-NET-MVC5-编程实战/">ASP.NET MVC5 编程实战</a>
		 
 </div>
 
<div id="comments" style="margin: 5px auto;">
	<div id="comment"></div>
                        <script>
                            new Valine({
                        el: '#comment' ,
                        notify:false, 
                        verify:false, 
                        appId: 'oTcHLJ1mpOGAcKcahsaQEBaQ-gzGzoHsz',
                        appKey: 'Jq4QEoyIo2Y40s3PHny873nz',
                        placeholder: ' ( *￣▽￣)((≧︶≦*)',
                        path:window.location.pathname, 
						avatar:'retro'
                    });
                        </script>
</div>
 
 <div class="art-item-footer">
		 
		 <span class="art-item-left">
				 <i class="icon icon-chevron-thin-left"></i>prev：<a href="/2018/02/09/ASP.NET05/" rel="prev" title="ASP.NET05">
						 ASP.NET05
				 </a>
		 </span>
		 
		 
		 <span class="art-item-right">
				 next：<a href="/2018/02/07/C#高效编程摘记/" rel="next" title="C#高效编程摘记">
						 C#高效编程摘记
				 </a><i class="icon icon-chevron-thin-right"></i>
		 </span>
		 
 </div>
 
</section>

</article>
<script>
window.subData = {
 title: 'ASP.NET MVC 控制器',
 tools: true
}
</script>

      </div>
      <aside class='l_side'>
        
  <section class='m_widget about'>

<img class='avatar waves-image' src='/images/avatar.jpg' />

<div class='header'>luox78</div>
<div class='content'>
<div class='desc'>It's always not too late to learn</div>
</div>
</section>

  <section class='m_widget'>
        <div class='header'>田馥甄-你就不要想起我</div>
<div>
    <audio src="https://luox78.github.io/images/田馥甄-你就不要想起我.mp3" controls="controls" style="width:250px;">
        田馥甄-你就不要想起我
    </audio>
</div>
</section>

  <section class='m_widget categories'>
<div class='header'>Categories</div>
<div class='content'>
    
    <ul class="entry">
    
        <li><a class="flat-box" href="/categories/ASP-NET/"><div class='name'>ASP.NET</div><div class='badget'>6</div></a></li>
    
        <li><a class="flat-box" href="/categories/ASP-NET-MVC/"><div class='name'>ASP.NET MVC</div><div class='badget'>1</div></a></li>
    
        <li><a class="flat-box" href="/categories/C/"><div class='name'>C#</div><div class='badget'>15</div></a></li>
    
        <li><a class="flat-box" href="/categories/DailyLearning/"><div class='name'>DailyLearning</div><div class='badget'>4</div></a></li>
    
        <li><a class="flat-box" href="/categories/JQuery/"><div class='name'>JQuery</div><div class='badget'>3</div></a></li>
    
        <li><a class="flat-box" href="/categories/JavaScript/"><div class='name'>JavaScript</div><div class='badget'>21</div></a></li>
    
        <li><a class="flat-box" href="/categories/Learning/"><div class='name'>Learning</div><div class='badget'>1</div></a></li>
    
    </ul>
    
</div>
</section>

  
<div class="m_widget tagcloud">
    <div class="header">Tags</div>
    <div class='content'>
        <a href="/tags/ASP-NET-MVC5-编程实战/" style="font-size: 14px; color: #808080">ASP.NET MVC5 编程实战</a> <a href="/tags/C-特性/" style="font-size: 15.5px; color: #606060">C#特性</a> <a href="/tags/DI/" style="font-size: 14px; color: #808080">DI</a> <a href="/tags/Entity-Framework/" style="font-size: 15.5px; color: #606060">Entity Framework</a> <a href="/tags/HtmlHelper拓展/" style="font-size: 14px; color: #808080">HtmlHelper拓展</a> <a href="/tags/IIS请求流程/" style="font-size: 14px; color: #808080">IIS请求流程</a> <a href="/tags/IOC/" style="font-size: 15.5px; color: #606060">IOC</a> <a href="/tags/Json/" style="font-size: 14px; color: #808080">Json</a> <a href="/tags/LINQ/" style="font-size: 15.5px; color: #606060">LINQ</a> <a href="/tags/MD5/" style="font-size: 14px; color: #808080">MD5</a> <a href="/tags/NOPI/" style="font-size: 14px; color: #808080">NOPI</a> <a href="/tags/SqlHelper/" style="font-size: 14px; color: #808080">SqlHelper</a> <a href="/tags/asp-net-mvc/" style="font-size: 14px; color: #808080">asp.net mvc</a> <a href="/tags/autofac/" style="font-size: 14px; color: #808080">autofac</a> <a href="/tags/bitwiseOperations/" style="font-size: 14px; color: #808080">bitwiseOperations</a> <a href="/tags/cache/" style="font-size: 14px; color: #808080">cache</a> <a href="/tags/http协议/" style="font-size: 14px; color: #808080">http协议</a> <a href="/tags/jQueryfoundation/" style="font-size: 17px; color: #404040">jQueryfoundation</a> <a href="/tags/jsfoundation/" style="font-size: 18.5px; color: #202020">jsfoundation</a> <a href="/tags/path/" style="font-size: 14px; color: #808080">path</a> <a href="/tags/request/" style="font-size: 14px; color: #808080">request</a> <a href="/tags/swagger/" style="font-size: 14px; color: #808080">swagger</a> <a href="/tags/thread/" style="font-size: 15.5px; color: #606060">thread</a> <a href="/tags/tips/" style="font-size: 14px; color: #808080">tips</a> <a href="/tags/viewstate/" style="font-size: 14px; color: #808080">viewstate</a> <a href="/tags/三层/" style="font-size: 15.5px; color: #606060">三层</a> <a href="/tags/分页/" style="font-size: 14px; color: #808080">分页</a> <a href="/tags/单例模式/" style="font-size: 14px; color: #808080">单例模式</a> <a href="/tags/发邮件/" style="font-size: 14px; color: #808080">发邮件</a> <a href="/tags/工厂模式/" style="font-size: 14px; color: #808080">工厂模式</a> <a href="/tags/文件上传下载/" style="font-size: 14px; color: #808080">文件上传下载</a> <a href="/tags/模拟IIS/" style="font-size: 14px; color: #808080">模拟IIS</a> <a href="/tags/深入理解JS/" style="font-size: 20px; color: #000">深入理解JS</a> <a href="/tags/深入理解aspx/" style="font-size: 14px; color: #808080">深入理解aspx</a> <a href="/tags/简单三层/" style="font-size: 14px; color: #808080">简单三层</a> <a href="/tags/线程/" style="font-size: 14px; color: #808080">线程</a> <a href="/tags/缩略图/" style="font-size: 14px; color: #808080">缩略图</a>
    </div>
</div>



  <section class='m_widget links'>
<div class='header'>Links</div>
<div class='content'>
    <ul class="entry">
    
        <li><a class="flat-box" target="_blank" href="https://github.com/luox78">
            <div class='name'>Github</div>
        </a></li>
    
        <li><a class="flat-box" target="_blank" href="https://www.baidu.com">
            <div class='name'>Baidu</div>
        </a></li>
    
    </ul>
</div>
</section>

      </aside>
    </div>
  </div>
  <footer id="footer" class="clearfix">

	<div class="social-wrapper">
  	
      
        <a href="https://github.com/luox78" class="social github"
          target="_blank" rel="external">
          <span class="icon icon-github"></span>
        </a>
      
        <a href="/" class="social twitter"
          target="_blank" rel="external">
          <span class="icon icon-twitter"></span>
        </a>
      
        <a href="/atom.xml" class="social rss"
          target="_blank" rel="external">
          <span class="icon icon-rss"></span>
        </a>
      
    
  </div>
  
  <div>
    <span>
        Powered by:<a href="https://hexo.io/" class="codename" target="_blank">
                       hexo
        </a>
    </span>
    <span> - </span>
    <span>
        Theme: <a href='https://github.com/stkevintan/hexo-theme-material-flow' class="codename" target="_blank">MaterialFlow</a> 
    </span>
    <span> - </span>
    <span id="busuanzi_container_site_pv">
        本站总访问量:
        <a href='http://ibruce.info/2015/04/04/busuanzi/' class="codename" target="_blank">
            <span id="busuanzi_value_site_pv"></span>
        </a>
    </span>
</div>
  
</footer>


  

<script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
<script src='//cdn.bootcss.com/node-waves/0.7.5/waves.min.js'></script>
<script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script>
<script src="/js/jquery.fitvids.js"></script>
<script>
	var GOOGLE_CUSTOM_SEARCH_API_KEY = "";
	var GOOGLE_CUSTOM_SEARCH_ENGINE_ID = "";
	var ALGOLIA_API_KEY = "";
	var ALGOLIA_APP_ID = "";
	var ALGOLIA_INDEX_NAME = "";
  var AZURE_SERVICE_NAME = "";
  var AZURE_INDEX_NAME = "";
  var AZURE_QUERY_KEY = "";
  var BAIDU_API_ID = "";
  var SEARCH_SERVICE = "hexo";
  var ROOT = "/"||"/";
  if(!ROOT.endsWith('/'))ROOT += '/';
</script>
<script src="/js/search.js"></script>
<script src="/js/app.js"></script>
<!--隐藏不是主页的wiget-->
<script>
  if(document.location.href !== "https://luox78.github.io/" && document.location.href !== "https://luox78.github.io/archives/" && document.location.href !== "http://localhost:4000/"){
    var foo = document.getElementsByClassName("l_side");
    for (let index = 0; index < foo.length; index++) {
      foo[index].style.display="none";
    }
  }
  Waves.attach('.vbtn', ['waves-button', 'waves-float']);
  Waves.attach(".u-search-form", ['.waves-circle']);
  Waves.init();

  //添加tr显示效果
  $(".article-entry>table tbody tr:odd").css("backgroundColor","rgb(235,236,238)");
	$("#loading").fadeOut(1000);
</script>


</body>
</html>
